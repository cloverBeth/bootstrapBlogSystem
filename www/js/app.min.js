"use strict";

var X_context = {
    guest: "guest",
    api: "http://192.168.6.43/zjsy/api/v1/",
    memberId: null,
    memberPhone: ""
};
X_context.authorization = readCookie('authorization') || X_context.authorization;

angular.module('ZJSY_WeChat', [
//'ngRoute',
'ui.router',
//'ui.bootstrap',
'mobile-angular-ui'])

//.config(function($routeProvider) {
//    $routeProvider.when('/', {
//        templateUrl:'home.html',
//        controller : 'HomeController',
//        reloadOnSearch: false
//    })
//        .when('/test', {
//            templateUrl:'test.html',
//            controller : 'TestController',
//            reloadOnSearch: false
//        });
//
//});
.config(["$stateProvider", "$urlRouterProvider", "$httpProvider", function ($stateProvider, $urlRouterProvider, $httpProvider) {
    //$httpProvider.defaults.useXDomain = true;
    $httpProvider.interceptors.push('ajaxInterceptor');
    $httpProvider.defaults.headers.post = {
        "Content-Type": "application/json;charset=utf-8",
        "Authorization": X_context.authorization

    };
    $httpProvider.defaults.headers.put = {
        "Content-Type": "application/json;charset=utf-8",
        "Authorization": X_context.authorization

    };
    $httpProvider.defaults.headers.get = {
        "Authorization": X_context.authorization

    };
    $httpProvider.defaults.headers["delete"] = {
        "Content-Type": "application/json;charset=utf-8",
        "Authorization": X_context.authorization

    };

    $stateProvider.state('store', { //将sotreid放在此路由
        url: '/store/{storeId}',
        views: {
            '': {
                templateUrl: 'store.html',
                controller: 'StoreController'
            }
        }
    }).state('store.product', {
        url: '/store-product/{productId}',
        views: {
            '': {
                templateUrl: 'storeProduct.html',
                controller: 'StoreProductController'
            }
        }
    }).state('store.sale', {
        url: '/store-sale',
        views: {
            '': {
                templateUrl: 'storeSale.html',
                controller: 'StoreSaleController'
            }
        }
    }).state('store.detail', {
        url: '/store-detail',
        views: {
            '': {
                templateUrl: 'storeDetail.html',
                controller: 'StoreDetailController'
            }
        }
    }).state('store.cart', {
        url: '/store-cart',
        views: {
            '': {
                templateUrl: 'storeCart.html',
                //controller:'StoreCartController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) return $state.go('login');
                    var ctrlName = "StoreCartController";
                    return ctrlName;
                }]
            }
        }
    }).state('accountCenter', {
        url: '/account-center',
        views: {
            '': {
                templateUrl: 'accountCenter.html',
                //controller: 'AccountCenterController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) return $state.go('login');
                    var ctrlName = "AccountCenterController";
                    return ctrlName;
                }]
            }
        }
    }).state('addressAccount', {
        url: '/address-account',
        params: { from: null },
        views: {
            '': {
                templateUrl: 'addressAccount.html',
                //controller:'AddressAccountController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) return $state.go('login');
                    var ctrlName = "AddressAccountController";
                    return ctrlName;
                }]
            }
        }
    }).state('addressEdit', {
        url: '/address-edit/{addrId}',
        params: { from: null },
        views: {
            '': {
                templateUrl: 'addressEdit.html',
                //controller:'AddressEditController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) return $state.go('login');
                    var ctrlName = "AddressEditController";
                    return ctrlName;
                }]
            }
        }
    }).state('card', {
        url: '/card',
        views: {
            '': {
                templateUrl: 'card.html',
                //controller:'CardAccountController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) {
                        return $state.go('login');
                    }
                    var ctrlName = "CardController";
                    return ctrlName;
                }]
            }
        }
    }).state('cardLogin', {
        url: '/card-login',
        params: { from: null },
        views: {
            '': {
                templateUrl: 'cardLogin.html',
                //controller:'CardAccountController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) {
                        return $state.go('login');
                    }
                    var ctrlName = "CardLoginController";
                    return ctrlName;
                }]
            }
        }
    }).state('transactionDetail', {
        url: '/transaction-detail',
        views: {
            '': {
                templateUrl: 'transactionDetail.html',
                //controller:'CardAccountController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) {
                        return $state.go('login');
                    }
                    var ctrlName = "TransactionDetailController";
                    return ctrlName;
                }]
            }
        }
    }).state('orderList', {
        url: '/order-list',
        views: {
            '': {
                templateUrl: 'orderList.html',
                //controller:'OrderListController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) return $state.go('login');
                    var ctrlName = "OrderListController";
                    return ctrlName;
                }]
            }
        }
    }).state('orderDetail', {
        url: '/order-detail/{orderId}',
        views: {
            '': {
                templateUrl: 'orderDetail.html',
                //controller:'OrderDetailController',
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) return $state.go('login');
                    var ctrlName = "OrderDetailController";
                    return ctrlName;
                }]
            }
        }
    }).state('login', {
        url: '/login',
        views: {
            '': {
                templateUrl: 'login.html',
                //controller: 'LoginController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (checkAuth.check()) return $state.go('accountCenter');
                    var ctrlName = "LoginController";
                    return ctrlName;
                }]
            }
        }

    }).state('getOrder', {
        url: '/getOrder',
        views: {
            '': {
                templateUrl: 'getOrder.html',
                //controller: 'GetOrderController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) return $state.go('login');
                    var ctrlName = "GetOrderController";
                    return ctrlName;
                }]
            }
        }

    }).state('orderSucceed', {
        url: '/order-succeed/{orderId}',
        views: {
            '': {
                templateUrl: 'orderSucceed.html',
                //controller:'OrderSucceedController'
                controllerProvider: ["$state", "$stateParams", "checkAuth", function controllerProvider($state, $stateParams, checkAuth) {
                    if (!checkAuth.check()) return $state.go('login');
                    var ctrlName = "OrderSucceedController";
                    return ctrlName;
                }]
            }
        }
    });

    $urlRouterProvider.otherwise('/store/1/store-product/');
}]);
/**
 * Created by gujun on 15/5/19.
 */
"use strict";
angular.module('ZJSY_WeChat').filter('card', function () {
  return function (input, num) {
    num = parseInt(num);
    input = input.split("");
    var out = "";
    for (var i in input) {
      if (i < input.length - num) {
        out += "*";
      } else {
        out += input[i];
      }
    }
    return out;
  };
});
/**
 * Created by gujun on 15/12/4.
 */
'use strict';

angular.module('ZJSY_WeChat').factory('checkAuth', function () {
    return {
        check: function check() {
            return X_context.authorization != "guest" && X_context.authorization;
        }
    };
});
/**
 * Created by gujun on 15/4/28.
 */
'use strict';

angular.module('ZJSY_WeChat').factory('ajaxInterceptor', ["$q", "$rootScope", "$location", function ($q, $rootScope, $location) {
  return {
    response: function response(_response) {
      if (_response.headers()['content-type'] === "application/json; charset=utf-8") {
        // Validate response, if not ok reject
        if (_response.data.code && _response.data.status) {
          if (_response.data.status == "ok" && _response.data.code == "200") {
            return _response;
          } else {
            $rootScope.$broadcast('alerts', { type: 'danger', message: _response.data.message || "系统错误。" });
            return _response;
          }
        }
      }
      if (_response.data.status == 404) {
        $rootScope.$broadcast('alerts', { type: 'danger', message: '资源不存在。' });
        $location.path('/');
        return _response;
      }
      return _response;
    },
    responseError: function responseError(response) {
      $rootScope.$broadcast('alerts', { type: 'danger', message: response.data.message || "系统错误。" });
      return response;
    }
  };
}]);
/**
 * Created by gujun on 15/12/2.
 */
'use strict';

angular.module('ZJSY_WeChat').directive('scrollOnClick', function () {
    return {
        restrict: 'A',
        link: function link(scope, $elm, attrs) {
            var idToScroll = attrs.scrollhref;
            var scrollBase = attrs.scrollbase;
            var scrollFirst = attrs.scrollfirst;
            $elm.on('click', function () {
                var $target;
                if (idToScroll) {
                    $target = $(idToScroll);
                }
                $(scrollBase).animate({ scrollTop: $target.offset().top - $(scrollFirst).offset().top }, 200);
            });
        }
    };
});
/**
 * Created by gujun on 15/12/2.
 */
"use strict";

angular.module('ZJSY_WeChat').directive("bnLazySrc", ["$window", "$document", function ($window, $document) {

    // I manage all the images that are currently being
    // monitored on the page for lazy loading.
    var lazyLoader = (function () {

        // I maintain a list of images that lazy-loading
        // and have yet to be rendered.
        var images = [];

        // I define the render timer for the lazy loading
        // images to that the DOM-querying (for offsets)
        // is chunked in groups.
        var renderTimer = null;
        var renderDelay = 100;

        // I cache the window element as a jQuery reference.
        var win = $($window);

        // I cache the document document height so that
        // we can respond to changes in the height due to
        // dynamic content.
        var doc = $document;
        var documentHeight = doc.height();
        var documentTimer = null;
        var documentDelay = 2000;

        // I determine if the window dimension events
        // (ie. resize, scroll) are currenlty being
        // monitored for changes.
        var isWatchingWindow = false;

        // ---
        // PUBLIC METHODS.
        // ---

        // I start monitoring the given image for visibility
        // and then render it when necessary.
        function addImage(image) {

            images.push(image);

            if (!renderTimer) {

                startRenderTimer();
            }

            if (!isWatchingWindow) {

                startWatchingWindow();
            }
        }

        // I remove the given image from the render queue.
        function removeImage(image) {

            // Remove the given image from the render queue.
            for (var i = 0; i < images.length; i++) {

                if (images[i] === image) {

                    images.splice(i, 1);
                    break;
                }
            }

            // If removing the given image has cleared the
            // render queue, then we can stop monitoring
            // the window and the image queue.
            if (!images.length) {

                clearRenderTimer();

                stopWatchingWindow();
            }
        }

        // ---
        // PRIVATE METHODS.
        // ---

        // I check the document height to see if it's changed.
        function checkDocumentHeight() {

            // If the render time is currently active, then
            // don't bother getting the document height -
            // it won't actually do anything.
            if (renderTimer) {

                return;
            }

            var currentDocumentHeight = doc.height();

            // If the height has not changed, then ignore -
            // no more images could have come into view.
            if (currentDocumentHeight === documentHeight) {

                return;
            }

            // Cache the new document height.
            documentHeight = currentDocumentHeight;

            startRenderTimer();
        }

        // I check the lazy-load images that have yet to
        // be rendered.
        function checkImages() {

            // Log here so we can see how often this
            // gets called during page activity.
            //console.log( "Checking for visible images..." );

            var visible = [];
            var hidden = [];

            // Determine the window dimensions.
            var windowHeight = win.height();
            var scrollTop = win.scrollTop();

            // Calculate the viewport offsets.
            var topFoldOffset = scrollTop;
            var bottomFoldOffset = topFoldOffset + windowHeight;

            // Query the DOM for layout and seperate the
            // images into two different categories: those
            // that are now in the viewport and those that
            // still remain hidden.
            for (var i = 0; i < images.length; i++) {

                var image = images[i];

                if (image.isVisible(topFoldOffset, bottomFoldOffset)) {

                    visible.push(image);
                } else {

                    hidden.push(image);
                }
            }

            // Update the DOM with new image source values.
            for (var i = 0; i < visible.length; i++) {

                visible[i].render();
            }

            // Keep the still-hidden images as the new
            // image queue to be monitored.
            images = hidden;

            // Clear the render timer so that it can be set
            // again in response to window changes.
            clearRenderTimer();

            // If we've rendered all the images, then stop
            // monitoring the window for changes.
            if (!images.length) {

                stopWatchingWindow();
            }
        }

        // I clear the render timer so that we can easily
        // check to see if the timer is running.
        function clearRenderTimer() {

            clearTimeout(renderTimer);

            renderTimer = null;
        }

        // I start the render time, allowing more images to
        // be added to the images queue before the render
        // action is executed.
        function startRenderTimer() {

            renderTimer = setTimeout(checkImages, renderDelay);
        }

        // I start watching the window for changes in dimension.
        function startWatchingWindow() {

            isWatchingWindow = true;

            // Listen for window changes.
            win.on("resize.bnLazySrc", windowChanged);
            win.on("scroll.bnLazySrc", windowChanged);

            //hardcode for productList
            $('.lazy-sec').on("resize.bnLazySrc", windowChanged);
            $('.lazy-sec').on("scroll.bnLazySrc", windowChanged);

            // Set up a timer to watch for document-height changes.
            documentTimer = setInterval(checkDocumentHeight, documentDelay);
        }

        // I stop watching the window for changes in dimension.
        function stopWatchingWindow() {

            isWatchingWindow = false;

            // Stop watching for window changes.
            win.off("resize.bnLazySrc");
            win.off("scroll.bnLazySrc");

            // Stop watching for document changes.
            clearInterval(documentTimer);
        }

        // I start the render time if the window changes.
        function windowChanged() {

            if (!renderTimer) {

                startRenderTimer();
            }
        }

        // Return the public API.
        return {
            addImage: addImage,
            removeImage: removeImage
        };
    })();

    // ------------------------------------------ //
    // ------------------------------------------ //

    // I represent a single lazy-load image.
    function LazyImage(element) {

        // I am the interpolated LAZY SRC attribute of
        // the image as reported by AngularJS.
        var source = null;

        // I determine if the image has already been
        // rendered (ie, that it has been exposed to the
        // viewport and the source had been loaded).
        var isRendered = false;

        // I am the cached height of the element. We are
        // going to assume that the image doesn't change
        // height over time.
        var height = null;

        // ---
        // PUBLIC METHODS.
        // ---

        // I determine if the element is above the given
        // fold of the page.
        function isVisible(topFoldOffset, bottomFoldOffset) {

            // If the element is not visible because it
            // is hidden, don't bother testing it.
            if (!element.is(":visible")) {

                return false;
            }

            // If the height has not yet been calculated,
            // the cache it for the duration of the page.
            if (height === null) {

                height = element.height();
            }

            // Update the dimensions of the element.
            var top = element.offset().top;
            var bottom = top + height;

            // Return true if the element is:
            // 1. The top offset is in view.
            // 2. The bottom offset is in view.
            // 3. The element is overlapping the viewport.
            return top <= bottomFoldOffset && top >= topFoldOffset || bottom <= bottomFoldOffset && bottom >= topFoldOffset || top <= topFoldOffset && bottom >= bottomFoldOffset;
        }

        // I move the cached source into the live source.
        function render() {

            isRendered = true;

            renderSource();
        }

        // I set the interpolated source value reported
        // by the directive / AngularJS.
        function setSource(newSource) {

            source = newSource;

            if (isRendered) {

                renderSource();
            }
        }

        // ---
        // PRIVATE METHODS.
        // ---

        // I load the lazy source value into the actual
        // source value of the image element.
        function renderSource() {

            element[0].src = source;
        }

        // Return the public API.
        return {
            isVisible: isVisible,
            render: render,
            setSource: setSource
        };
    }

    // ------------------------------------------ //
    // ------------------------------------------ //

    // I bind the UI events to the scope.
    function link($scope, element, attributes) {

        var lazyImage = new LazyImage(element);

        // Start watching the image for changes in its
        // visibility.
        lazyLoader.addImage(lazyImage);

        // Since the lazy-src will likely need some sort
        // of string interpolation, we don't want to
        attributes.$observe("bnLazySrc", function (newSource) {

            lazyImage.setSource(newSource);
        });

        // When the scope is destroyed, we need to remove
        // the image from the render queue.
        $scope.$on("$destroy", function () {

            lazyLoader.removeImage(lazyImage);
        });
    }

    // Return the directive configuration.
    return {
        link: link,
        restrict: "A"
    };
}]);
/**
 * Created by gujun on 15/7/8.
 */

'use strict';

angular.module('ZJSY_WeChat').directive('alerts', ["$interval", "$timeout", function ($interval, $timeout) {
    return {
        restrict: 'E',
        template: '<div class="site-alert col-sm-12 ">\
                <div ng-repeat="alert in alerts" class="alert alert-danger alert-dismissible" role="alert">\
                    <button type="button" class="close" data-dismiss="alert" ng-click="closeAlert($index)" aria-label="Close"><span aria-hidden="true">&times;</span></button>\
                    <strong>{{alert.msg}}</strong></div>\
                </div>',
        scope: true,
        link: function link(scope) {
            scope.alerts = [];

            scope.closeAlert = function (index) {
                scope.alerts.splice(index, 1);
            };

            //var interval = $interval(function(){scope.alerts = _.drop(scope.alerts)},5000);

            scope.$on("$destroy", function () {
                //$interval.cancel(interval);

            });

            scope.$on('alerts', function (event, alert) {
                scope.alerts.push({ type: alert.type, msg: alert.message });
                $timeout(function () {
                    scope.alerts = _.drop(scope.alerts);
                }, 2000);
            });
        }
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('TransactionDetailController', ["$scope", "$state", function ($scope, $state) {
    $scope.title = '交易明细';
    $scope.transaction = [{
        number: '20151208092590',
        order: '666666',
        cost: '25',
        order_date: '2015-12-08 00:00:20'
    }];
    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('StoreSaleController', ["$scope", "$http", function ($scope, $http) {
    "use strict";
    $scope._ = _;

    $scope.$parent.title = $scope.$parent.storeTitle;

    console.log($scope.$parent.$parent.cart, $scope.$parent.$parent.storeId);

    $scope.cart = $scope.$parent.$parent.cart;

    $scope.hots = [];
    $scope.$parent.storePromise.then(function () {
        return $http.post(X_context.api + 'product/list', {
            storeId: $scope.$parent.storeId,
            isFav: "true"
        }).success(function (data) {
            _.forEach(data.data, function (pro, index) {
                $scope.hots.push({
                    id: pro.id,
                    name: pro.name,
                    num: pro.amount,
                    img: pro.img ? pro.img : "images/ph_1.jpg",
                    detail: pro.specification,
                    cateId: pro.category,
                    price: pro.marketPrice
                });
            });
        });
    });

    //$scope.hots = [
    //    {
    //        id : 7,
    //        name : "中餐盒饭1",
    //        price : "18.5",
    //        num : "5",
    //        img : "images/ph_1.jpg",
    //        detail : "鸡腿饭是一道菜，使用鸡腿、青椒、黄瓜、米饭做成。依据食谱步骤来完成这道料理。照烧（照り焼き，てりやき，Teriyaki），知名日本菜肴及烹饪方法。"
    //    },
    //    {
    //        id : 10,
    //        name : "中餐盒饭4",
    //        price : "18.5",
    //        num : "5",
    //        img : "images/ph_1.jpg",
    //        detail : "鸡腿饭是一道菜，使用鸡腿、青椒、黄瓜、米饭做成。依据食谱步骤来完成这道料理。照烧（照り焼き，てりやき，Teriyaki），知名日本菜肴及烹饪方法。"
    //
    //    },
    //    {
    //        id : 11,
    //        name : "中餐盒饭5",
    //        price : "18.5",
    //        num : "5",
    //        img : "images/ph_1.jpg",
    //        detail : "鸡腿饭是一道菜，使用鸡腿、青椒、黄瓜、米饭做成。依据食谱步骤来完成这道料理。照烧（照り焼き，てりやき，Teriyaki），知名日本菜肴及烹饪方法。"
    //
    //    },
    //    {
    //        id : 12,
    //        name : "中餐盒饭6",
    //        price : "18.5",
    //        num : "5",
    //        img : "images/ph_1.jpg",
    //        detail : "鸡腿饭是一道菜，使用鸡腿、青椒、黄瓜、米饭做成。依据食谱步骤来完成这道料理。照烧（照り焼き，てりやき，Teriyaki），知名日本菜肴及烹饪方法。"
    //
    //    },
    //    {
    //        id : 13,
    //        name : "西餐咖啡1",
    //        price : "18.5",
    //        num : "5",
    //        img : "images/ph_1.jpg",
    //        detail : "鸡腿饭是一道菜，使用鸡腿、青椒、黄瓜、米饭做成。依据食谱步骤来完成这道料理。照烧（照り焼き，てりやき，Teriyaki），知名日本菜肴及烹饪方法。"
    //
    //    },
    //    {
    //        id : 14,
    //        name : "西餐咖啡2",
    //        price : "18.5",
    //        num : "5",
    //        img : "images/ph_1.jpg",
    //        detail : "鸡腿饭是一道菜，使用鸡腿、青椒、黄瓜、米饭做成。依据食谱步骤来完成这道料理。照烧（照り焼き，てりやき，Teriyaki），知名日本菜肴及烹饪方法。"
    //
    //    }
    //]

    $scope.productDetail = {};
    $scope.prodectShown = false;

    $scope.mainHeight = $('body').css('height').split('px')[0] - $('.navTop').css('height').split('px')[0] - $('header').css('height').split('px')[0];

    $scope.addProduct = function (id) {
        console.log(id);
        var exist = _.find($scope.cart.products, { id: id });
        if (exist) {
            if (exist.buyNum < exist.num) exist.buyNum++;
        } else {
            $scope.cart.products.push(_.clone(_.find($scope.hots, { id: id })));
            _.find($scope.cart.products, { id: id }).buyNum = 1;
        }
    };

    $scope.removeProduct = function (id) {
        if (!_.find($scope.cart.products, { id: id })) return;
        if (_.find($scope.cart.products, { id: id }).buyNum > 1) {
            _.find($scope.cart.products, { id: id }).buyNum--;
        } else {
            $scope.cart.products = _.reject($scope.cart.products, { id: id });
        }
        if ($scope.cart.products.length == 0) {
            $scope.showCart = false;
        }
    };

    $scope.showProduct = function (id) {
        //get data from api instead
        console.log(id);
        $scope.productDetail = _.find($scope.hots, { id: id });
        if ($scope.productDetail) {
            $scope.prodectShown = true;
        }
    };

    $scope.fly = function ($event) {
        flyItem($event);
    };

    function flyItem(event) {
        if ($('.cart-img-zero').offset().top == 0) {
            var offset = $('.cart-img').offset();
        } else {
            var offset = $('.cart-img-zero').offset();
        }

        var flyer = $('<img class="flyer" src="images/bg_5.png"/>');
        flyer.fly({
            start: {
                left: event.pageX,
                top: event.pageY
            },
            end: {
                left: offset.left,
                top: offset.top + 10,
                width: 0,
                height: 0
            },
            peed: 10, //越大越快，默认1.2
            vertex_Rtop: 100,
            onEnd: function onEnd() {
                $('.flyer').remove();
                $(".shop em").addClass("a-shake");

                setTimeout(function () {
                    $(".shop em").removeClass("a-shake");
                }, 300);
            }
        });
    }
}]);

"use strict";
angular.module('ZJSY_WeChat').controller('StoreProductController', ["$scope", "$timeout", "$http", "$q", "$stateParams", function ($scope, $timeout, $http, $q, $stateParams) {

    $scope._ = _;

    $scope.$parent.title = $scope.$parent.storeTitle;

    console.log($scope.$parent.$parent.cart, $scope.$parent.$parent.storeId);

    $scope.cart = $scope.$parent.$parent.cart;

    $scope.cateList = [];
    $scope.proList = [];

    var catePromise = $scope.$parent.storePromise.then(function () {
        return $http.post(X_context.api + 'category/list', {
            storeId: $scope.$parent.storeId
        }).success(function (data) {
            _.forEach(data.data, function (cate, index) {
                $scope.cateList.push({
                    name: cate.categoryName,
                    sort: cate.sort,
                    id: cate.id
                });
                _.sortBy($scope.cateList, function (n) {
                    return n.sort;
                });
                for (var i in $scope.cateList) {
                    $scope.cateList[i].sec = 'sec' + (parseInt(i) + 1);
                }
            });
        });
    });

    var productPromise = $scope.$parent.storePromise.then(function () {
        return $http.post(X_context.api + 'product/list', {
            storeId: $scope.$parent.storeId
        }).success(function (data) {
            _.forEach(data.data, function (pro, index) {
                $scope.proList.push({
                    id: pro.id,
                    name: pro.name,
                    num: pro.amount,
                    img: pro.image ? pro.image : "images/ph_1.jpg",
                    detail: pro.specification,
                    cateId: pro.category,
                    price: pro.marketPrice
                });
            });
        });
    });

    $scope.hotList = [];
    $scope.$parent.storePromise.then(function () {
        return $http.post(X_context.api + 'product/list', {
            storeId: $scope.$parent.storeId,
            isHot: true
        }).success(function (data) {
            _.forEach(data.data, function (pro, index) {
                $scope.hotList.push({
                    id: pro.id,
                    name: pro.name,
                    num: pro.amount,
                    img: pro.image ? pro.image : "images/ph_1.jpg",
                    detail: pro.specification,
                    cateId: pro.category,
                    price: pro.marketPrice
                });
            });
        });
    });

    $q.all([catePromise, productPromise]).then(function () {

        _.forEach($scope.cateList, function (item, index) {
            item.products = _.filter($scope.proList, { cateId: item.id });
        });
        if ($stateParams.productId) {
            console.log('hahaha', $scope.proList);
            $scope.showProduct($stateParams.productId);
        }
    });

    $scope.hots = $scope.hotList;

    $scope.cates = $scope.cateList;

    $scope.productDetail = {};
    $scope.productShown = false;

    //$scope.showCart = false;
    //$scope.toggleCart = function(){
    //   $scope.showCart =  !$scope.showCart;
    //   $scope.$parent.showCart = $scope.showCart;
    //};

    //$scope.mainHeight = $('body').css('height').split('px')[0] -
    //    $('.navTop').css('height').split('px')[0] -
    //    $scope.$parent.navHeight-
    //    $('header').css('height').split('px')[0];

    $scope.$watch('$parent.navHeight', function () {
        $scope.mainHeight = $('body').css('height').split('px')[0] - $('.navTop').css('height').split('px')[0] - $scope.$parent.navHeight - $('header').css('height').split('px')[0];
    });
    //$scope.proList = [];
    //_.forEach($scope.cates,function(cate,index){
    //    $scope.proList = $scope.proList.concat(cate.products);
    //});

    $scope.addProduct = function (id) {
        var exist = _.find($scope.cart.products, { id: id });
        if (exist) {
            if (exist.buyNum < exist.num) exist.buyNum++;
        } else {
            $scope.cart.products.push(_.clone(_.find($scope.proList, { id: id })));
            _.find($scope.cart.products, { id: id }).buyNum = 1;
        }
    };

    $scope.removeProduct = function (id) {
        if (!_.find($scope.cart.products, { id: id })) return;
        if (_.find($scope.cart.products, { id: id }).buyNum > 1) {
            _.find($scope.cart.products, { id: id }).buyNum--;
        } else {
            $scope.cart.products = _.reject($scope.cart.products, { id: id });
        }
        if ($scope.cart.products.length == 0) {
            $scope.showCart = false;
        }
    };

    $scope.showProduct = function (id) {
        //get data from api instead
        $scope.productDetail = _.find($scope.proList, { id: parseInt(id) });
        if ($scope.productDetail) {
            $scope.productShown = true;
        }
    };

    $scope.fly = function ($event) {
        flyItem($event);
    };

    function flyItem(event) {
        if ($('.cart-img-zero').offset().top == 0) {
            var offset = $('.cart-img').offset();
        } else {
            var offset = $('.cart-img-zero').offset();
        }

        var flyer = $('<img class="flyer" src="images/bg_5.png"/>');
        flyer.fly({
            start: {
                left: event.pageX,
                top: event.pageY
            },
            end: {
                left: offset.left,
                top: offset.top + 10,
                width: 0,
                height: 0
            },
            peed: 10, //越大越快，默认1.2
            vertex_Rtop: 100,
            onEnd: function onEnd() {
                $('.flyer').remove();
                $(".shop em").addClass("a-shake");

                setTimeout(function () {
                    $(".shop em").removeClass("a-shake");
                }, 300);
            }
        });
    }

    //jquery

    var scrollPass = true;
    $scope.$$postDigest(function () {
        scrollPass = true;
    });
    $scope.$parent.$$postDigest(function () {
        scrollPass = true;
    });

    $(".greens").on('scroll', function () {

        if (!scrollPass) {
            return;
        } else {
            scrollPass = false;
            console.log('scroll');
        }

        var headerTop = $(".header").height() + $scope.$parent.navHeight + $(".sound").height() + $(".navTop").height() + 30;

        if ($scope.$parent.navHeight == 150) {
            if (parseInt($(".greens ul:eq(0)").offset().top) < headerTop - 30) {
                $scope.$parent.navHeight = 0;
                //$scope.$apply();
                $scope.$digest();
                $scope.$parent.$digest();
            }
            scrollPass = true;
        } else if ($scope.$parent.navHeight == 0) {
            if (parseInt($(".greens ul:eq(0)").offset().top) >= headerTop - 30) {
                $scope.$parent.navHeight = 150;
                //$scope.$apply();
                $scope.$digest();
                $scope.$parent.$digest();
            }
            scrollPass = true;
        }

        for (var i = 0; i < $(".greens ul").length; i++) {
            var top = parseInt($(".greens ul:eq(" + i + ")").offset().top);
            if (top < headerTop) {
                $(".sideNav li a").removeClass("hover");
                $(".sideNav li:eq(" + i + ") a").addClass("hover");
            }
        }
    });
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('StoreDetailController', ["$scope", function ($scope) {

    $scope.$parent.storePromise.then(function () {
        $scope.storeDetail = {
            name: $scope.$parent.storeDetail.storeName,
            startrule: $scope.$parent.storeDetail.freight || 0,
            distribution: $scope.$parent.storeDetail.freightfee || 0,
            intro: $scope.$parent.storeDetail.introduce,
            addr: $scope.$parent.storeDetail.address,
            openTime: $scope.$parent.storeDetail.worktime,
            tel: $scope.$parent.storeDetail.telephone,
            storeImage: $scope.$parent.storeDetail.image || 'images/ph_3.jpg'

        };
    });
}]);
"use strict";

angular.module('ZJSY_WeChat').controller('StoreController', ["$scope", "$location", "$state", "$stateParams", "$http", function ($scope, $location, $state, $stateParams, $http) {
    $scope.storeTitle = "";
    $scope.title = "";
    $scope.navHeight = 150;

    console.log('storeId', $stateParams.storeId);
    $scope.storeId = $stateParams.storeId || X_context.storeId || 1;
    X_context.storeId = $scope.storeId;
    $scope.cart = $scope.$parent.cart;
    $scope.notice = {};

    $scope.storePromise = $http.post(X_context.api + 'store/list', {
        storeId: $scope.storeId
    }).success(function (data) {
        $scope.storeDetail = data.data[0];
        $scope.storeTitle = data.data[0].storeName;
        $scope.title = data.data[0].storeName;
        $scope.cart.min = data.data[0].freight;
        $scope.cart.freightFee = data.data[0].freightfee;
        $scope.notice.title = data.data[0].annTitle;
        $scope.notice.content = data.data[0].announcement;
    });

    $scope.isActive = function (route) {
        if (_.indexOf($location.path().split('/'), route.split('/')[1]) > 0) {
            return true;
        } else {
            return false;
        }
    };

    var swiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        slidesPerView: 1

    });

    $scope.showCart = false;
    $scope.toggleCart = function () {
        $scope.showCart = !$scope.showCart;
    };

    $scope.totalPrice = 0;
    $scope.$watch('cart.products', function (cart) {
        $scope.totalPrice = 0;
        _.forEach($scope.cart.products, function (prod, key) {
            $scope.totalPrice += prod.price * prod.buyNum;
        });
    }, true);

    $scope.addProduct = function (id) {
        console.log('id', id);
        var exist = _.find($scope.cart.products, { id: id });
        if (exist) {
            if (exist.buyNum < exist.num) exist.buyNum++;
        } else {
            $scope.cart.products.push(_.clone(_.find($scope.proList, { id: id })));
            _.find($scope.cart.products, { id: id }).buyNum = 1;
        }
    };

    $scope.removeProduct = function (id) {
        if (!_.find($scope.cart.products, { id: id })) return;
        if (_.find($scope.cart.products, { id: id }).buyNum > 1) {
            _.find($scope.cart.products, { id: id }).buyNum--;
        } else {
            $scope.cart.products = _.reject($scope.cart.products, { id: id });
        }
        if ($scope.cart.products.length == 0) {
            $scope.showCart = false;
        }
    };

    $scope.goToCart = function () {
        if ($scope.totalPrice == 0) return;
        $state.transitionTo('store.cart');
    };

    $scope.getOrder = function () {
        if ($scope.totalPrice == 0) return;
        $scope.$parent.order.product = $scope.cart.products;
        $scope.$parent.order.storeId = $scope.storeId;
        $state.transitionTo('getOrder');
    };

    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('StoreCartController', ["$scope", "$http", "$stateParams", "$state", function ($scope, $http, $stateParams, $state) {
    $scope.$parent.title = "购物车";

    $scope.cart = $scope.$parent.$parent.cart;

    //$scope.username = "陈冠希";
    //$scope.phone = "13232311009";
    //$scope.address = "香港XX摄影工作室";
    $scope.$parent.memberPromise.then(function () {
        $http.post(X_context.api + "addr/list", {
            memberId: X_context.memberId,
            addrId: $stateParams.addrId
        }).success(function (data) {
            var datas = data.data;
            $scope.username = datas[0].receiver;
            $scope.phone = datas[0].mobile;
            $scope.address = datas[0].addressFullname;
        });
    });

    $scope.mainHeight = $('body').css('height').split('px')[0] - $('header').css('height').split('px')[0];

    $scope.selectAddress = function () {
        $state.go('addressAccount', { from: { fromCart: true } });
    };
}]);
"use strict";
angular.module("ZJSY_WeChat").controller("OrderSucceedController", ["$scope", "$state", "$http", "$stateParams", function ($scope, $state, $http, $stateParams) {
    console.log($stateParams.orderId);
    $scope.title = "购物成功";
    //$scope.telphone='012-7654987';

    var orderListApi = X_context.api + "order/list";
    $http.post(orderListApi, {
        id: $stateParams.orderId
    }).success(function (data) {
        console.log(data.data);
        var datas = data.data;
        if (!datas[0]) {
            return;
        }
        $scope.orderSucceed = {
            orderNumber: datas[0].orderSn,
            quantity: datas[0].orderDetail.length,
            payway: datas[0].paymentMethod,
            distribution: datas[0].shippingPrice,
            expense: datas[0].totalPrice
        };
    });

    //telphone:datas[0].telephone

    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('OrderListController', ["$scope", "$http", "$state", function ($scope, $http, $state) {
    var orderListApi = X_context.api + "order/list";
    //console.log('parent',$scope.$parent);
    $scope.title = "我的订单";
    $scope.orderlist = [];

    $http.post(orderListApi, {}).success(function (data) {
        if (!data.data) return;
        for (var i in data.data) {
            var order = {
                number: data.data[i].id,
                states: data.data[i].orderStatus,
                orderDate: data.data[i].createDate,
                products: [],
                total: data.data[i].totalPrice,
                totalNum: data.data[i].orderDetail ? data.data[i].orderDetail.length : 0
            };
            _.forEach(data.data[i].orderDetail, function (item, i) {
                order.products.push({
                    quantity: item.quantity,
                    image: item.image,
                    id: item.id
                });
            });

            $scope.orderlist.push(order);
        }
    });
    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('OrderDetailController', ["$scope", "$stateParams", "$http", "$state", function ($scope, $stateParams, $http, $state) {
    console.log($stateParams.orderId);

    $scope.title = '我的订单';
    var orderListApi = X_context.api + "order/list";

    $scope.orderpills = [];

    $http.post(orderListApi, {
        id: $stateParams.orderId
    }).success(function (data) {
        console.log(data.data);
        var datas = data.data;
        if (!datas[0]) {
            return;
        }
        $scope.orderone = {
            orderNum: datas[0].orderSn,
            states: datas[0].orderStatus,
            address: datas[0].address,
            guest: datas[0].receiver,
            payway: datas[0].paymentMethod,
            total: datas[0].totalPrice,
            carriage: datas[0].shippingPrice,
            //credits:datas[0].userPoint,
            realpay: datas[0].totalPrice + datas[0].shippingPrice,
            orderpills: []

        };

        _.forEach(datas[0].orderDetail, function (item) {

            $scope.orderone.orderpills.push({
                quantity: item.quantity,
                standard: item.unitName,
                brands: item.productName,
                weight: item.itemSn,
                id: item.id,
                price: item.unitPrice

            });
        });
        $scope.orderpills.push($scope.orderone);
    });

    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
'use strict';

angular.module('ZJSY_WeChat').controller('MainController', ["$scope", "$location", "$http", function ($scope, $location, $http) {
    "use strict";
    $scope.memberPromise = null;
    $scope.cart = {
        products: [
            //{
            //    id: 0,
            //    name: "雀巢麦片",
            //    num: 156,
            //    img: "images/ph_1.jpg",
            //    detail: "营养高，味道好",
            //    cateId: 1,
            //    price: 30,
            //    buyNum: 1
            //}
        ],
        min: 0,
        freightFee: 0
    };
    $scope.order = {
        storeId: 1,
        product: [{
            id: 1,
            name: "雀巢麦片",
            num: 99999,
            img: "https://www.baidu.com/img/bd_logo1.png",
            detail: "frfr飒飒",
            cateId: 29,
            price: 30,
            buyNum: 1
        }]
    };
    if (X_context.authorization && X_context.authorization != X_context.guest) {
        $scope.memberPromise = $http.get(X_context.api + 'member/getCurMem').success(function (data) {
            if (!data.data[0]) return;
            X_context.memberId = data.data[0]._id;
            X_context.memberPhone = data.data[0].mobile;
        });
    }
    $scope.isActive = function (route) {
        if (_.indexOf($location.path().split('/'), route.split('/')[1]) > 0) {
            return true;
        } else {
            return false;
        }
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('LoginController', ["$scope", "$interval", "$http", function ($scope, $interval, $http) {

    $scope.login = {
        title: '验证手机'
    };

    var btnStr = '获取验证码';
    $scope.telphone = '';
    $scope.captcha = '';
    $scope.captchaBtn = btnStr;
    $scope.captchaDisabled = false;

    $scope.setTime = function () {
        if ($scope.captchaDisabled == true) {
            return;
        }
        $http.post(X_context.api + "member/fetchAuthCode", {
            "phoneNum": $scope.telphone
        }).success(function (data) {
            console.log(data);
            $scope.captchaDisabled = true;
            $scope.ensureBtn = true;
            var timer = 60;
            var interval = $interval(function () {
                $scope.captchaBtn = '请您稍后:' + timer;
                timer--;
                if (timer == 0) {
                    $interval.cancel(interval);
                    $scope.captchaDisabled = false;
                    $scope.captchaBtn = btnStr;
                }
            }, 1000);
        });
    };

    $scope.phoneReg = /^([0-9]{11})$/;

    $scope.getEnSure = function () {
        if ($scope.telphone != null && $scope.phoneReg.test($scope.telphone)) {
            $scope.captchaDisabled = false;
            console.log($scope.captchaDisabled);
            $http.post(X_context.api + "member/weixinLogin", {
                phoneNum: $scope.telphone,
                authCode: $scope.captcha
            }).success(function (data) {
                console.log('data.data.token', data.data.token);
                if (data.data.token) {
                    X_context.authorization = data.data.token;
                    $http.defaults.headers.post['Authorization'] = X_context.authorization;
                    $http.defaults.headers.put['Authorization'] = X_context.authorization;
                    $http.defaults.headers.get['Authorization'] = X_context.authorization;
                    $http.defaults.headers['delete']['Authorization'] = X_context.authorization;
                    //$cookies.put('authorization',X_context.authorization);
                    createCookie('authorization', X_context.authorization);

                    $scope.$parent.memberPromise = $http.get(X_context.api + 'member/getCurMem').success(function (data) {
                        if (!data.data[0]) return;
                        X_context.memberId = data.data[0]._id;
                        X_context.memberPhone = data.data[0].mobile;
                    });
                }
                window.history.back();
            });
        }
        //else{
        //    $scope.captchaDisabled=true;
        //    console.log( $scope.captchaDisabled);
        //}
    };

    //$(function(){
    //    $scope.befocus=function(){
    //        $('#usertel').focus();
    //    }
    //    $scope.getfocus=function(){
    //        $('#usercheck').focus();
    //    }
    //});
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('GetOrderController', ["$scope", "$location", "$state", "$stateParams", "$http", function ($scope, $location, $state, $stateParams, $http) {
    $scope.order = $scope.$parent.order;
    $scope.cart = $scope.$parent.cart;

    //$scope.username = "陈冠希";
    //$scope.phone = "13232311009";
    //$scope.address = "香港XX摄影工作室";

    $scope.payOption = "delivery";

    var posted = false;

    $scope.totalPrice = 0;
    _.forEach($scope.order.product, function (item, index) {
        $scope.totalPrice += item.price * item.buyNum;
    });

    $scope.postOrder = function () {
        if (posted == true) return;
        posted = true;
        var orderList = [];
        _.forEach($scope.order.product, function (item, index) {
            orderList.push({
                productId: item.id,
                quantity: item.buyNum,
                unitPrice: item.price
            });
        });
        $http.post(X_context.api + 'order/add', {
            "storeId": $scope.order.storeId,
            "address": $scope.address,
            "orderStatus": "未处理",
            "payMethod": $scope.payOption == "delivery" ? "现金" : "一卡通",
            "phone": $scope.phone,
            "receiver": $scope.username,
            "orderItems": orderList

        }).success(function (data) {
            $scope.cart.products = [];
            $state.go('orderSucceed', { orderId: data.data[0]._id });
        });
    };

    $scope.$parent.memberPromise.then(function () {
        $http.post(X_context.api + "addr/list", {
            memberId: X_context.memberId,
            addrId: $stateParams.addrId
        }).success(function (data) {
            var datas = data.data;
            $scope.username = datas[0].receiver;
            $scope.phone = datas[0].mobile;
            $scope.address = datas[0].addressFullname;
        });
    });

    $scope.postOrderAndPay = function () {

        if (posted == true) return;
        posted = true;
        var orderList = [];
        _.forEach($scope.order.product, function (item, index) {
            orderList.push({
                productId: item.id,
                quantity: item.buyNum,
                unitPrice: item.price
            });
        });
        $http.post(X_context.api + 'order/add', {
            "storeId": $scope.order.storeId,
            "address": $scope.address,
            "orderStatus": "未处理",
            "payMethod": $scope.payOption == "delivery" ? "现金" : "一卡通",
            "phone": $scope.phone,
            "receiver": $scope.username,
            "orderItems": orderList

        }).success(function (data) {
            $scope.cart.products = [];
            $state.go('cardLogin', { from: { fromOrder: true, orderId: data.data[0]._id } });
        });
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('CardLoginController', ["$scope", "$interval", "$http", "$stateParams", "$state", function ($scope, $interval, $http, $stateParams, $state) {

    $scope.fromOrder = $stateParams.from && $stateParams.from.fromOrder;
    $scope.orderId = $stateParams.from && $stateParams.from.orderId;

    $scope.showEdit = false;
    $scope.card = {
        title: '一卡通',
        num: "",
        pwd: ""
    };
    $scope.originNo = "";

    $scope.payModal = false;

    var posted = false;
    var payPosted = false;

    $scope.editCard = function ($event) {
        $event.stopPropagation();
        $scope.showEdit = true;
    };

    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };

    $scope.getEnSure = function () {
        if ($scope.card.num == null) return;
        if (posted == true) return;
        posted = true;

        if (!$scope.showEdit) {
            if ($scope.fromOrder) {
                console.log($stateParams.from.orderId);
                $scope.payModal = true;
                //$state.go('orderSucceed');
                $scope.showEdit = false;
                posted = false;
            } else {
                $scope.showEdit = false;
                posted = false;
            }
        } else {
            if ($scope.card.num != $scope.originNo) {
                $http.post(X_context.api + "member/updateCard", {
                    memberId: X_context.memberId,
                    cardNo: $scope.card.num
                }).success(function (data) {
                    $state.go($state.current, $stateParams, { reload: true, inherit: false });
                    $scope.showEdit = false;
                    posted = false;
                });
            }
            $scope.showEdit = false;
            posted = false;
        }
    };

    $scope.pay = function () {
        if (payPosted == true) return;
        payPosted = true;
        if (!$scope.card.pwd || !$scope.card.num || !$scope.orderId) return;
        $http.post(X_context.api + 'pay/consume', {
            "orderId": $scope.orderId,
            "memberCard": $scope.card.num,
            "passwd": $scope.card.pwd
        }).success(function (data) {
            $scope.$parent.cart.products = [];
            payPosted = false;
            $state.go('orderSucceed', { orderId: data.data[0]._id });
        }).error(function (data) {
            console.log(data);
            payPosted = false;
            $state.go('orderSucceed', { orderId: data.data[0]._id });
        });
    };

    $http.get(X_context.api + 'member/getCurMem').success(function (data) {
        $scope.card.num = data.data[0].allincardNo;
        $scope.originNo = data.data[0].allincardNo;
    });
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('CardController', ["$scope", "$state", function ($scope, $state) {
    $scope.card = {
        title: '我的一卡通'
    };
    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('AddressEditController', ["$scope", "$stateParams", "$http", "$state", function ($scope, $stateParams, $http, $state) {
    $scope.title = '编辑地址';

    var addressAccountListApi = X_context.api + "addr/list";
    console.log('$stateParams.addrId', $stateParams.addrId);

    if ($stateParams.addrId) {
        $http.post(addressAccountListApi, {
            addrId: $stateParams.addrId
        }).success(function (data) {
            var datas = data.data;
            $scope.user = datas[0].receiver;
            $scope.telphone = datas[0].mobile;
            $scope.detailArea = datas[0].addressFullname;
        });
    };

    $scope.update = function () {
        if (!$stateParams.addrId) {
            $http.post(X_context.api + "addr/add", {
                "member": X_context.memberId,
                "receiver": $scope.user,
                "addressFullname": $scope.detailArea,
                "mobile": $scope.telphone
            }).success(function (data) {
                console.log(data.data);
                $scope.goBack();
            });
        } else {
            $http.post(X_context.api + "addr/update", {
                "addrId": $stateParams.addrId,
                "receiver": $scope.user,
                "addressFullname": $scope.detailArea,
                "mobile": $scope.telphone
            }).success(function (data) {
                console.log(data);
                $scope.goBack();
            });
        }
    };

    console.log("$stateParams", $stateParams.from && $stateParams.from.fromCart);
    $scope.goBack = function () {
        if ($stateParams.from && $stateParams.from.fromCart) {
            return $state.go('store.cart');
        } else {
            window.history.back();
        }
    };

    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('AddressAccountController', ["$scope", "$state", "$stateParams", "$http", function ($scope, $state, $stateParams, $http) {

    $scope.title = "收货地址";
    $scope.addNewAddr = false;
    $scope.address = {
        id: null
    };

    $scope.$parent.memberPromise.then(function () {
        $http.post(X_context.api + "addr/list", {
            memberId: X_context.memberId,
            addrId: $stateParams.addrId
        }).success(function (data) {
            var datas = data.data;
            if (datas.length == 0) {
                $scope.addNewAddr = true;
                return;
            }
            $scope.address.id = datas[0].id;
            $scope.address.user = datas[0].receiver;
            $scope.address.telphone = datas[0].mobile;
            $scope.address.detailArea = datas[0].addressFullname;
        });
    });

    console.log("$stateParams", $stateParams.from && $stateParams.from.fromCart);

    $scope.goToCart = function () {
        if ($stateParams.from && $stateParams.from.fromCart) {
            $state.go('store.cart');
        }
    };

    $scope.editAddress = function () {
        $state.go('addressEdit', { from: { fromCart: $stateParams.from && $stateParams.from.fromCart }, addrId: $scope.address.id });
    };

    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
"use strict";
angular.module('ZJSY_WeChat').controller('AccountCenterController', ["$scope", "$state", "$http", function ($scope, $state, $http) {
    console.log('X_context.memberPhone', X_context.memberPhone);
    if ($scope.$parent.memberPromise) {
        $scope.$parent.memberPromise.then(function () {
            $scope.account = {
                title: '我的中心',
                tel: X_context.memberPhone,
                contact: '021-12345678',
                payWay: '一卡通'
            };
        });
    } else {
        $scope.account = {
            title: '我的中心',
            tel: X_context.memberPhone,
            contact: '021-12345678',
            payWay: '一卡通'
        };
    }

    $scope.signOut = function () {
        console.log('here,logout');
        X_context.authorization = X_context.guest;
        eraseCookie('authorization');
        $state.go('store.product', { storeId: X_context.storeId });
    };
    $scope.goIndex = function () {
        $state.go('store.product', { storeId: X_context.storeId });
    };
}]);
/**
 * Created by gujun on 15/12/2.
 */
'use strict';

(function ($) {
    $.fly = function (element, options) {
        // 默认值
        var defaults = {
            version: '1.0.0',
            autoPlay: true,
            vertex_Rtop: 20, // 默认顶点高度top值
            speed: 1.2,
            start: {}, // top, left, width, height
            end: {},
            onEnd: $.noop
        };

        var self = this,
            $element = $(element);

        /**
         * 初始化组件，new的时候即调用
         */
        self.init = function (options) {
            this.setOptions(options);
            !!this.settings.autoPlay && this.play();
        };

        /**
         * 设置组件参数
         */
        self.setOptions = function (options) {
            this.settings = $.extend(true, {}, defaults, options);
            var settings = this.settings,
                start = settings.start,
                end = settings.end;

            $element.css({ marginTop: '0px', marginLeft: '0px', position: 'absolute' }).appendTo('body');
            /* 运动过程中有改变大小
             if (end.width != null && end.height != null) {
             $.extend(true, start, {
             width: $element.width(),
             height: $element.height()
             });
             }
             */ // 运动轨迹最高点top值
            var vertex_top = Math.min(start.top, end.top) - Math.abs(start.left - end.left) / 3;
            if (vertex_top < settings.vertex_Rtop) {
                // 可能出现起点或者终点就是运动曲线顶点的情况
                vertex_top = Math.min(settings.vertex_Rtop, Math.min(start.top, end.top));
            }

            /**
             * ======================================================
             * 运动轨迹在页面中的top值可以抽象成函数 y = a * x*x + b;
             * a = curvature
             * b = vertex_top
             * ======================================================
             */

            var distance = Math.sqrt(Math.pow(start.top - end.top, 2) + Math.pow(start.left - end.left, 2)),

            // 元素移动次数
            steps = Math.ceil(Math.min(Math.max(Math.log(distance) / 0.05 - 75, 30), 100) / settings.speed),
                ratio = start.top == vertex_top ? 0 : -Math.sqrt((end.top - vertex_top) / (start.top - vertex_top)),
                vertex_left = (ratio * start.left - end.left) / (ratio - 1),

            // 特殊情况，出现顶点left==终点left，将曲率设置为0，做直线运动。
            curvature = end.left == vertex_left ? 0 : (end.top - vertex_top) / Math.pow(end.left - vertex_left, 2);

            $.extend(true, settings, {
                count: -1, // 每次重置为-1
                steps: steps,
                vertex_left: vertex_left,
                vertex_top: vertex_top,
                curvature: curvature
            });
        };

        /**
         * 开始运动，可自己调用
         */
        self.play = function () {
            this.move();
        };

        /**
         * 按step运动
         */
        self.move = function () {
            var settings = this.settings,
                start = settings.start,
                count = settings.count,
                steps = settings.steps,
                end = settings.end;
            // 计算left top值
            var left = start.left + (end.left - start.left) * count / steps,
                top = settings.curvature == 0 ? start.top + (end.top - start.top) * count / steps : settings.curvature * Math.pow(left - settings.vertex_left, 2) + settings.vertex_top;
            // 运动过程中有改变大小
            if (end.width != null && end.height != null) {
                var i = steps / 2,
                    width = end.width - (end.width - start.width) * Math.cos(count < i ? 0 : (count - i) / (steps - i) * Math.PI / 2),
                    height = end.height - (end.height - start.height) * Math.cos(count < i ? 0 : (count - i) / (steps - i) * Math.PI / 2);
                $element.css({ width: width + "px", height: height + "px", "font-size": Math.min(width, height) + "px" });
            }
            $element.css({
                left: left + "px",
                top: top + "px"
            });
            settings.count++;
            // 定时任务
            var time = window.requestAnimationFrame($.proxy(this.move, this));
            if (count == steps) {
                window.cancelAnimationFrame(time);
                // fire callback
                settings.onEnd.apply(this);
            }
        };

        /**
         * 销毁
         */
        self.destroy = function () {
            $element.remove();
        };

        self.init(options);
    };

    // add the plugin to the jQuery.fn object
    $.fn.fly = function (options) {
        return this.each(function () {
            if (undefined == $(this).data('fly')) {
                $(this).data('fly', new $.fly(this, options));
            }
        });
    };
})(jQuery);
/*
 * jquery.fly
 *
 * 抛物线动画
 * @github https://github.com/amibug/fly
 * Copyright (c) 2014 wuyuedong
 * copy from tmall.com
 */
/**
 * Created by gujun on 15/12/8.
 */
"use strict";

function createCookie(name, value, days) {
    var expires;

    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
        expires = "; expires=" + date.toGMTString();
    } else {
        expires = "";
    }
    document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value) + expires + "; path=/";
}

function readCookie(name) {
    var nameEQ = encodeURIComponent(name) + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
    }
    return null;
}

function eraseCookie(name) {
    createCookie(name, "", -1);
}
angular.module("ZJSY_WeChat").run(["$templateCache", function($templateCache) {$templateCache.put("accountCenter.html","<div class=\"main-section\">\n\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">\n            {{account.title}}\n        </div>\n        <div class=\"del\">\n            <a ng-click=\"goIndex()\" href=\"javascript:;\" class=\"blue\">主页</a>\n        </div>\n    </header>\n\n    <div class=\"main mt-48\">\n        <div class=\"head clearfix\">\n            <em><img src=\"images/head.png\" /></em>\n            <p>\n                {{account.tel}}\n            </p>\n        </div>\n        <div class=\"personal\">\n            <ul>\n                <li>\n                    <a ui-sref=\"orderList\"><em><img src=\"images/ico_12.png\" /></em>我的订单</a>\n                </li>\n                <li>\n                    <a ui-sref=\"addressAccount\"><em><img src=\"images/ico_13.png\" /></em>收货地址</a>\n                </li>\n                <li>\n                    <a ui-sref=\"card\"><em><img src=\"images/ico_13.png\" /></em>{{account.payWay}}</a>\n                </li>\n            </ul>\n            <ul>\n                <li>\n                    <strong><em><img src=\"images/ico_14.png\" /></em>联系我们</strong>\n                    <span>{{account.contact}}</span>\n                </li>\n            </ul>\n\n        </div>\n        <div class=\"btnQ\">\n            <a href=\"javascript:;\" ng-click=\"signOut()\">退出登录</a>\n        </div>\n    </div>\n</div>");
$templateCache.put("addressAccount.html","<div class=\"main-section\">\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">\n            {{title}}\n        </div>\n        <div class=\"del\">\n            <a ng-click=\"goIndex()\"href=\"javascript:;\" class=\"blue\">主页</a>\n        </div>\n    </header>\n\n    <div class=\"main mt-48\" >\n        <div class=\"address\" ng-hide=\"addNewAddr\">\n            <ul>\n                <li style=\"border:none;\">\n                    <p ng-click=\"goToCart()\">\n                        {{address.user}}    {{address.telphone}}<br />\n                        {{address.detailArea}}\n                    </p>\n                        <span>\n                            <a ng-click=\"editAddress()\"><img src=\"images/ico_10.png\" />编辑</a>\n                        </span>\n                </li>\n            </ul>\n        </div>\n\n\n\n\n        <div class=\"redBtn\"ng-show=\"addNewAddr\">\n            <button type=\"button\" class=\"btn col-sm-8 btn-block\"href=\"javascript:;\"ng-click=\"editAddress()\">新增地址</button>\n        </div>\n\n\n    </div>\n\n</div>");
$templateCache.put("addressEdit.html","\n<div class=\"main-section\">\n\n<header class=\"header\">\n    <div class=\"back\">\n        <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n    </div>\n    <div class=\"title\">\n        {{title}}\n    </div>\n    <div class=\"del\">\n        <a ng-click=\"goIndex()\"href=\"javascript:;\" class=\"blue\">主页</a>\n    </div>\n    <!--<div class=\"del\"><a href=\"#\" class=\"blue\">删除</a></div>-->\n</header>\n\n<div class=\"main mt-40\">\n    <div class=\"iphone\">\n        <ul>\n            <li><span>收货人</span><input type=\"text\" placeholder=\"请输入姓名\" class=\"input1\"\n                                       ng-model=\"user\"/></li>\n            <li><span>手　机</span><input type=\"text\" placeholder=\"请输入手机号码\" class=\"input1\"\n                    ng-model=\"telphone\"/></li>\n            <li><span>地　址</span><input type=\"text\" placeholder=\"请输入详细地址\" class=\"input1\"\n                    ng-model=\"detailArea\"/></li>\n        </ul>\n    </div>\n    <div class=\"redBtn\">\n        <button type=\"button\" class=\"btn col-sm-8 btn-block\"href=\"javascript:;\"ng-click=\"update();\">确定</button>\n    </div>\n</div>\n\n</div>");
$templateCache.put("card.html","<div class=\"main-section\">\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">{{card.title}}</div>\n        <div class=\"del\">\n            <a ng-click=\"goIndex()\"href=\"javascript:;\" class=\"blue\">主页</a>\n        </div>\n    </header>\n\n    <div class=\"main mt-48\" >\n        <div class=\"personal\">\n            <ul>\n                <li>\n                    <a ui-sref=\"cardLogin\"><em><img src=\"images/ico_12.png\" /></em>绑定一卡通</a>\n                </li>\n                <li>\n                    <a ui-sref=\"transactionDetail\"><em><img src=\"images/ico_13.png\" /></em>交易明细</a>\n                </li>\n            </ul>\n        </div>\n    </div>\n</div>");
$templateCache.put("cardLogin.html","\n<div class=\"main-section\">\n\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">\n            {{card.title}}\n        </div>\n        <div class=\"del\">\n            <a ng-click=\"goIndex()\"href=\"javascript:;\" class=\"blue\">主页</a>\n        </div>\n    </header>\n\n    <div style=\"height: 46px;\"></div>\n    <div class=\"card\" ng-show=\"!showEdit\">\n        <span style=\"margin-right: 20px;\">卡号</span>\n        <span>{{(card.num) | card:4}}</span>\n        <a href=\"javascript:;\" ng-click=\"editCard($event)\" style=\"float:right;\">\n            {{card.num ? \"修改\" : \"绑定\"}}\n        </a>\n    </div>\n\n\n    <div class=\"form-horizontal row\" name=\"addForm\" ng-show=\"showEdit\" autocomplete=\"off\">\n        <div class=\"iphone\">\n\n            <label for=\"cardnum\" class=\"col-sm-3 control-label\" style=\"margin-left:30px;\">卡号</label>\n            <input id=\"cardnum\" type=\"text\" class=\"input1\" style=\"font-size:15px\" placeholder=\"请绑定一卡通卡号\"\n                   ng-model=\"card.num\" name=\"cardnum\" required/>\n        </div>\n    </div>\n    <div class=\"redBtn form-group\" ng-show=\"showEdit || fromOrder\">\n        <button type=\"submit\"  class=\"btn col-sm-8 btn-block ensure\" style=\"line-height:2rem\" ng-click=\"getEnSure()\">确定</button>\n    </div>\n\n\n    <div ui-content-for=\"modals\">\n        <div class=\"modal\" ng-if=\"payModal\">\n            <div class=\"modal-backdrop in\"></div>\n            <div class=\"modal-dialog\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-header\">\n                        <button class=\"close\"\n                                ng-click=\"$parent.payModal=false\">&times;</button>\n                        <h5 class=\"modal-title\">一卡通支付</h5>\n                    </div>\n                    <div class=\"modal-body\">\n                        <p >\n                            请输入一卡通密码:\n                        </p>\n                        <input type=\"password\" ng-model=\"card.pwd\" class=\"form-control\" style=\"margin:10px 0;width: 80%;font-size: 20px;\"/>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button ng-click=\"$parent.payModal=false\" class=\"btn btn-default\">取消</button>\n                        <button ng-click=\"pay()\" class=\"btn  greenBtn\">支付</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n");
$templateCache.put("getOrder.html","<div class=\"main main-section\">\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">\n            结算付款\n        </div>\n    </header>\n    <div class=\"navTop\" ></div>\n    <div class=\" \">\n\n        <div class=\"addressNoArrow address clearfix\">\n            <em><img src=\"images/ico_6.png\" /></em>\n            <p>\n                {{username}}    {{phone}}<br />\n                {{address}}\n            </p>\n        </div>\n        <div class=\"parcel\">\n            <h3>包裹详情</h3>\n            <ul>\n                <li ng-repeat=\"item in order.product track by $index\">\n                    <em><a href=\"#\"><img src=\"{{item.img}}\" /></a></em>\n                    <p>\n                        <strong>{{item.name}}</strong>\n                        <b>x {{item.buyNum}}</b>\n                    </p>\n                    <span>￥{{item.price * item.buyNum}}</span>\n                </li>\n                <li>\n                <span style=\"float: right;\">\n                    总价 :￥{{totalPrice + parseInt($parent.cart.freightFee==0 || totalPrice >= $parent.cart.min\n                                                ? \"0\" : $parent.cart.freightFee)}}\n                    (含配送费￥{{$parent.cart.freightFee==0 || totalPrice >= $parent.cart.min\n                                                ? \"0\" : $parent.cart.freightFee}})\n                </span>\n\n                </li>\n            </ul>\n\n        </div>\n        <div class=\"pay clearfix\">\n            <!--<h3>支付方式</h3><strong>货到付款</strong>-->\n            <ul class=\"pay-list block\">\n                <li class=\"pay-item tap-action pay-item-wapweixin icon-ok\" ng-click=\"payOption=\'card\'\">\n                    <i class=\"pay-icon pay-icon-wechat\"></i>\n                    一卡通支付\n                    <i class=\"pay-icon pay-icon-selected\"\n                       ng-show=\"payOption==\'card\'\"></i>\n                </li>\n                <hr>\n                <li class=\"pay-item tap-action  pay-item-delivery\" ng-click=\"payOption=\'delivery\'\">\n                    <i class=\"pay-icon pay-icon-delivery\"></i>\n                    货到付款\n                    <i class=\"pay-icon pay-icon-selected\"\n                       ng-show=\"payOption==\'delivery\'\"></i>\n                </li>\n            </ul>\n        </div>\n        <div style=\"width: 80%;margin: 20px auto;\">\n            <button ng-show=\"payOption==\'delivery\'\" class=\"btn btn-lg\" style=\"background: #dd0000;width: 100%;\" ng-click=\"postOrder()\">\n                提交订单\n            </button>\n\n            <button ng-show=\"payOption==\'card\'\" class=\"btn btn-lg\" style=\"background: #dd0000;width: 100%;\" ng-click=\"postOrderAndPay()\">\n                立即支付\n            </button>\n        </div>\n\n    </div>\n\n</div>\n");
$templateCache.put("login.html","\n<div class=\"main-section\">\n\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">\n            {{login.title}}\n        </div>\n    </header>\n\n\n    <form class=\"main loginForm form-horizontal container\"name=\"addForm\">\n        <div class=\"iphone row\">\n                <label for=\"telphone\" class=\"col-sm-3 control-label\">您的手机号:</label>\n                <input id=\"telphone\" type=\"tel\" ng-pattern=\"phoneReg\"class=\"input1\"style=\"font-size: 20px\"\n                       ng-model=\"telphone\"name=\"phoneInput\"required/>\n        </div>\n        <div class=\"iphone row\">\n                <label class=\"col-sm-3 control-label\"for=\"checknum\">您的验证码:</label>\n                <input type=\"number\" id=\"checknum\" value=\"\" class=\"input2\" style=\"font-size: 20px\"\n                       ng-model=\"captcha\"required/>\n                <button type=\"button\" href=\"javascript:;\"\n                   ng-disabled=\"addForm.phoneInput.$invalid\"\n                   class=\"btn autocodeBtn\"\n                   ng-click=\"setTime()\">\n                    {{captchaBtn}}\n                </button>\n        </div>\n        <div class=\"redBtn\">\n            <button type=\"submit\" ng-disabled=\"addForm.$invalid\" class=\"btn col-sm-10 ensure\"ng-click=\"getEnSure()\">确定</button>\n        </div>\n    </form>\n</div>\n");
$templateCache.put("orderDetail.html","<div class=\"main-section\"style=\"padding-bottom:50px\">\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">\n            {{title}}\n        </div>\n        <div class=\"del\">\n            <a ng-click=\"goIndex()\" class=\"blue\">主页</a>\n        </div>\n    </header>\n\n\n\n    <div class=\"main mt-48\">\n\n        <dl class=\"dandl\">\n            <dt class=\"clearfix\">\n                <strong>订单详情</strong>\n                <span>{{orderone.states}}</span>\n            </dt>\n            <dd>\n                <ul class=\"danq\">\n                    <li ng-repeat=\"pills in orderone.orderpills track by $index\">\n                        <p>{{pills.brands}}{{pills.weight}}*{{pills.standard}}</p>\n                        <span>× {{pills.quantity}}</span>\n                        <strong>¥{{pills.price}}</strong>\n                    </li>\n                </ul>\n            </dd>\n        </dl>\n        <dl class=\"dandl\">\n            <dt class=\"clearfix\">\n                <strong>收货地址</strong>\n            </dt>\n            <dd>\n                <ul class=\"shou\">\n                    <li><span>订单编号</span><p>{{orderone.orderNum}}</p></li>\n                    <li><span>收货地址</span><p>{{orderone.address}}</p></li>\n                    <li><span>收  货  人</span><p>{{orderone.guest}}</p></li>\n                    <li><span>支付方式</span><p>{{orderone.payway}}</p></li>\n                </ul>\n            </dd>\n        </dl>\n        <dl class=\"dandl\">\n            <dt class=\"clearfix\">\n                <strong>价格详情</strong>\n            </dt>\n            <dd>\n                <ul class=\"shou\">\n                    <li><span>商品总价</span><p>¥{{orderone.total}}</p></li>\n                    <li><span>运费</span><p>¥{{orderone.carriage}}</p></li>\n                    <!--<li><span>积分抵用</span><p>-¥{{orderone.credits}}</p></li>-->\n                    <li><span>实付金额</span><p class=\"org\">¥{{orderone.realpay}}</p></li>\n                </ul>\n            </dd>\n        </dl>\n    </div>\n</div>");
$templateCache.put("orderList.html","<div class=\"main-section\"style=\"padding-bottom:50px\">\n    <header class=\"header orderlistheader\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">\n            {{title}}\n        </div>\n        <div class=\"del\">\n            <a ng-click=\"goIndex()\"href=\"javascript:;\" class=\"blue\">主页</a>\n        </div>\n    </header>\n\n    <div class=\"main\">\n        <div class=\"dan\"\n                ng-repeat=\"order in orderlist track by $index\">\n            <div class=\"hao clearfix orderno\">\n                <strong>订单号：{{order.number}}</strong>\n                <span>{{order.states}}</span>\n            </div>\n\n            <div class=\"pic clearfix\">\n                <ul>\n                    <li ng-repeat=\"product in order.products\">\n                        <em><img src=\"{{product.image}}\" /></em>\n                        <p>×{{product.quantity}}</p>\n                    </li>\n                </ul>\n                <span ui-sref=\"orderDetail({orderId:order.number})\">共 {{order.totalNum}} 件</span>\n            </div>\n\n            <div class=\"time clearfix\">\n                <strong>{{order.orderDate | date:\"yyyy-MM-dd HH:mm:ss\"}}</strong>\n                <span class=\"iscanceled\">合计：<font>¥{{order.total}}</font></span>\n            </div>\n        </div>\n\n\n    </div>\n</div>");
$templateCache.put("orderSucceed.html","<div class=\"main-section\">\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n        </div>\n        <div class=\"title\">\n            {{title}}\n        </div>\n    </header>\n\n    <div class=\"main mt-48\">\n\n        <div class=\"succeed clearfix\">\n            <p>\n                <strong>您的订单已提交成功，我们会尽快配送！</strong>\n                如您需要取消订单，请拨打商家服务热线。\n            </p>\n        </div>\n        <div class=\"danhao\">\n            <p><font>订单编号</font>{{orderSucceed.orderNumber}}</p>\n            <p><font>商品数量</font>{{orderSucceed.quantity}}件</p>\n            <p><font>本次消费</font>{{orderSucceed.expense}} （含配送费{{orderSucceed.distribution}}）</p>\n        </div>\n        <div class=\"pay clearfix\">\n            <h3>支付方式</h3><strong>{{orderSucceed.payway}}</strong>\n        </div>\n        <div class=\"pay clearfix\">\n            <h3>商家电话</h3><strong>{{telphone}}</strong>\n        </div>\n        <div class=\"redBtn\">\n            <a class=\"btn btn-danger\"ng-click=\"goIndex()\"href=\"javascript:;\">继续逛逛</a>\n        </div>\n    </div>\n    <div class=\"kong\"></div>\n</div>\n");
$templateCache.put("sidebar.html","<h1 class=\"app-name\">MAUI-Demo</h1>\n\n<div class=\"scrollable\">\n  <h1 class=\"scrollable-header app-name\">MAUI-Demo</h1>  \n  <div class=\"scrollable-content\">\n    <div class=\"list-group\" ui-turn-off=\'uiSidebarLeft\'>\n      <a class=\"list-group-item\" ui-sref=\"home\" href=\"javascript:;\">Home <i class=\"fa fa-chevron-right pull-right\"></i></a>\n      <a class=\"list-group-item\" ui-sref=\"test\" href=\"javascript:;\">Test<i class=\"fa fa-chevron-right pull-right\"></i></a>\n    </div>\n\n  </div>\n</div>");
$templateCache.put("store.html","<header class=\"header\">\n  <div class=\"back\">\n    <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\" /></a>\n  </div>\n  <div class=\"title\">\n    {{title}}\n  </div>\n  <div class=\"vip\">\n    <a ui-sref=\"accountCenter\"><img src=\"images/vip.png\" /></a>\n  </div>\n</header>\n<div class=\"swiper-container\" ng-show=\"isActive(\'/store-product\')\" ng-style=\"{height:navHeight}\">\n  <div class=\"swiper-wrapper\">\n    <div class=\"swiper-slide\"><img src=\"images/banner.jpg\" width=\"100%\" /></div>\n    <div class=\"swiper-slide\"><img src=\"images/banner.jpg\" width=\"100%\" /></div>\n    <div class=\"swiper-slide\"><img src=\"images/banner.jpg\" width=\"100%\" /></div>\n    <div class=\"swiper-slide\"><img src=\"images/banner.jpg\" width=\"100%\" /></div>\n  </div>\n  <div class=\"swiper-pagination\"></div>\n</div>\n<div class=\"navTop\" >\n  <ul class=\"clearfix\" ng-show=\"isActive(\'/store-product\') || isActive(\'/store-sale\') || isActive(\'/store-detail\')\">\n    <li><a href=\"javascript:;\" ng-click=\"goIndex()\"\n           ng-class=\"{hover:isActive(\'/store-product\')}\">商品</a></li>\n    <li><a href=\"javascript:;\" ui-sref=\"store.sale\"\n           ng-class=\"{hover:isActive(\'/store-sale\')}\">优惠</a></li>\n    <li><a href=\"javascript:;\" ui-sref=\"store.detail\"\n           ng-class=\"{hover:isActive(\'/store-detail\')}\">商家</a></li>\n  </ul>\n</div>\n<div class=\"sound\" ng-show=\"isActive(\'/store-product\') || isActive(\'/store-sale\')\">\n  {{notice.title}}<a href=\"javascript:;\" style=\"float: right;margin-right: 20px;\" id=\"notice\" class=\"blue\" ui-turn-on=\"noticeModal\">详情</a>\n</div>\n<ui-view></ui-view>\n\n<div ng-show=\"isActive(\'/store-product\') || isActive(\'/store-sale\') || isActive(\'/store-cart\')\">\n  <footer class=\"footer\">\n    <div class=\"shop clearfix\" style=\"z-index: 20;\">\n      <p ng-show=\"cart.products.length == 0\">\n        <font>满￥{{cart.min}}免配送费</font>\n        <img class=\"cart-img-zero\" src=\"images/ico_9.png\"/>\n        购物车是空的\n      </p>\n      <div class=\"clearfix\" ng-show=\"cart.products.length > 0\">\n        <em ng-click=\"toggleCart()\">\n          <img class=\"cart-img\" src=\"images/ico_9.png\" />\n          <b>{{cart.products.length}}</b>\n        </em>\n        <strong>￥{{totalPrice}}\n          <font ng-show=\"cart.min > totalPrice\">还差￥{{cart.min - totalPrice}}免配送费</font>\n        </strong>\n        <span ng-hide=\"isActive(\'/store-cart\')\">\n            <a ng-disabled=\"totalPrice == 0\" href=\"javascript:;\" ng-click=\"goToCart()\">选好了</a>\n        </span>\n\n        <span ng-show=\"isActive(\'/store-cart\')\">\n            <a ng-disabled=\"totalPrice == 0\" href=\"javascript:;\" ng-click=\"getOrder()\">去下单</a>\n        </span>\n      </div>\n    </div>\n  </footer>\n\n  <div class=\"cart-cover shopN\" ng-show=\"showCart\">\n  </div>\n  <div class=\"cart\" >\n    <dl ng-style=\"{\'height\':showCart?\'400px\':\'0px\'}\">\n      <dt class=\"clearfix\">\n        <span ng-click=\"toggleCart()\" ><a href=\"javascript:;\" id=\"qk\"><img src=\"images/ico_5.png\" /></a></span>\n      </dt>\n      <dd>\n        <ul>\n          <li ng-repeat=\"pro in cart.products track by $index\">\n            <strong>{{pro.name}}</strong>\n            <b class=\"org\">￥{{pro.price * pro.buyNum}}</b>\n            <div class=\"numN fr\">\n              <a href=\"javascript:;\" class=\"add1\" ng-click=\"addProduct(pro.id)\">\n                <img src=\"images/ico_a1.png\" />\n              </a>\n              <span>{{pro.buyNum}}</span>\n              <a href=\"javascript:;\" class=\"sub1\" ng-click=\"removeProduct(pro.id)\">\n                <img src=\"images/ico_j1.png\" />\n              </a>\n            </div>\n          </li>\n        </ul>\n      </dd>\n    </dl>\n  </div>\n</div>\n<div ui-content-for=\"modals\">\n  <div class=\"modal modal-overlay\" ui-if=\'noticeModal\' ui-state=\'noticeModal\'>\n    <div class=\"modal-dialog\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <button class=\"close\"\n                  ui-turn-off=\"noticeModal\">&times;</button>\n          <h4 class=\"modal-title\">店家公告</h4>\n        </div>\n        <div class=\"modal-body\">\n          <p >\n            {{notice.content}}\n          </p>\n        </div>\n        <div class=\"modal-footer\">\n          <button ui-turn-off=\"noticeModal\" class=\"btn btn-default\">知道了</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n");
$templateCache.put("storeCart.html","<div ng-style=\"{height:mainHeight-42}\" class=\"main\">\n\n    <div class=\"address clearfix\" ng-click=\"selectAddress()\">\n        <em><img src=\"images/ico_6.png\" /></em>\n        <p>\n            {{username}}    {{phone}}<br />\n            {{address}}\n        </p>\n    </div>\n    <div class=\"shopList\">\n        <h3>购物列表</h3>\n        <ul>\n            <li ng-repeat=\"item in cart.products track by $index\">\n                <em><img src=\"{{item.img}}\"/></em>\n                <p>\n                    <strong>{{item.name}}</strong>\n                    <b>￥{{item.price}}</b>\n                </p>\n                <div class=\"numN fl mt20\">\n                    <a href=\"javascript:;\" class=\"add1\" ng-click=\"addProduct(item.id);\">\n                        <img src=\"images/ico_a1.png\"></a>\n                    <span>\n                        {{\n                            item.buyNum\n                        }}\n                    </span>\n                    <a href=\"javascript:;\" class=\"sub1\" ng-click=\"removeProduct(item.id)\">\n                        <img src=\"images/ico_j1.png\">\n                    </a>\n                </div>\n            </li>\n        </ul>\n        <div class=\"supply\">\n            由<a href=\"#\">{{$parent.storeTitle}}</a>供货\n        </div>\n    </div>\n\n</div>");
$templateCache.put("storeDetail.html","\n<div class=\"store\">\n	<em><img src=\"{{storeDetail.storeImage}}\" /></em>\n	<strong ng-model=\"shop.name\">{{storeDetail.name}}</strong>\n	<div class=\"clear\"></div>\n	<p>\n		起送价:<font>{{storeDetail.startrule}}</font> / 配送费:<font>{{storeDetail.distribution}}</font>\n	</p>\n</div>\n\n<div class=\"stores\">\n	<h3>商家信息</h3>\n	<ul>\n		<li class=\"row\"><span class=\"col-xs-4\"style=\"left:15px;\">商家简介：</span><p class=\"col-xs-8\"\n			style=\"padding: 0;\">{{storeDetail.intro}}</p></li>\n		<li class=\"row\"><span class=\"col-xs-4\"style=\"left:15px;\">商家地址：</span><p class=\"col-xs-8\"\n			style=\"padding: 0;\">{{storeDetail.addr}}</p></li>\n		<li class=\"row\"><span class=\"col-xs-4\"style=\"left:15px;\">营业时间：</span><p class=\"col-xs-8\"\n			style=\"padding: 0;\"	>{{storeDetail.openTime}}</p></li>\n		<li class=\"row\"><span class=\"col-xs-4\"style=\"left:15px;\">商家电话：</span><p  class=\"col-xs-8\"\n			style=\"padding: 0;\">{{storeDetail.tel}}</p></li>\n	</ul>\n</div>\n\n\n\n\n\n\n\n");
$templateCache.put("storeProduct.html","<div class=\"main main-section\" ng-style=\"{height:mainHeight-42}\">\n\n\n<div class=\"sideNav fl\" ng-style=\"{height:mainHeight-79}\">\n    <ul>\n        <li class=\"hover1\">\n            <a scroll-on-click scrollBase=\"#base\" scrollFirst=\"#hot\" scrollHref=\"#hot\"\n               class=\"hover\" href=\"javascript:;\"><img src=\"images/ico_3.png\" />热卖推荐</a>\n        </li>\n        <li ng-repeat=\"cate in cates track by $index\">\n            <a scroll-on-click scrollBase=\"#base\" scrollFirst=\"#hot\" scrollHref=\"#{{cate.sec}}\" href=\"javascript:;\">{{cate.name}}</a>\n        </li>\n    </ul>\n\n\n\n    </div>\n    <div class=\"productList fr\" ng-style=\"{height:mainHeight-79}\">\n        <div class=\"greens lazy-sec relR scrollable-content-div\" id=\"base\">\n            <ul class=\"clearfix\" id=\"hot\">\n                <li class=\"product-item\" ng-repeat=\"hot in hots track by $index\">\n                    <em>\n                        <div class=\"product-image-div\">\n                            <a ng-click=\"showProduct(hot.id)\" href=\"javascript:;\" class=\"showPH\">\n\n                                <img class=\"product-image\" bn-lazy-src=\"{{hot.img}}\" alt=\"加载中..\"/>\n\n                            </a>\n                        </div>\n                    </em>\n                    <p>\n                        <strong>{{hot.name}}</strong>\n                        <b class=\"org\">￥{{hot.price}}</b>\n                    </p>\n                    <div class=\"num\">\n                        <a href=\"javascript:;\"\n                           ng-click=\"addProduct(hot.id);fly($event)\"\n                           ng-hide=\"_.find(cart.products,{id:hot.id}) &&\n                           _.find(cart.products,{id:hot.id}).buyNum == _.find(cart.products,{id:hot.id}).num\"\n                           class=\"add\">\n                            <img src=\"images/ico_a.png\" />\n                        </a>\n                        <div ng-show=\"_.find(cart.products,{id:hot.id})\">\n                            <span>\n                                {{\n                                   _.find(cart.products,{id:hot.id})\n                                ? _.find(cart.products,{id:hot.id}).buyNum\n                                : 0\n                                }}\n                            </span>\n                            <a href=\"javascript:;\" ng-click=\"removeProduct(hot.id)\" class=\"sub\">\n                                <img src=\"images/ico_j.png\" /></a>\n\n                        </div>\n                    </div>\n                </li>\n\n            </ul>\n\n            <ul class=\"clearfix\" ng-repeat=\"cate in cates track by $index\" id=\"{{cate.sec}}\">\n                <li ng-repeat=\"pro in cate.products\">\n                    <em>\n                        <div class=\"product-image-div\">\n                            <a href=\"javascript:;\" class=\"showPH\" ng-click=\"showProduct(pro.id)\">\n                            <img class=\"product-image\" bn-lazy-src=\"{{pro.img}}\" alt=\"加载中..\" /></a>\n                        </div>\n                    </em>\n                    <p>\n                        <strong>{{pro.name}}</strong>\n                        <b class=\"org\">￥{{pro.price}}</b>\n                    </p>\n                    <div class=\"num\">\n                        <a href=\"javascript:;\" class=\"add\" ng-click=\"fly($event);addProduct(pro.id);\"\n                           ng-hide=\"_.find(cart.products,{id:pro.id}) &&\n                           _.find(cart.products,{id:pro.id}).buyNum == _.find(cart.products,{id:pro.id}).num\">\n                            <img src=\"images/ico_a.png\" /></a>\n                        <div ng-show=\"_.find(cart.products,{id:pro.id})\">\n                            <span>\n                                {{\n                                    _.find(cart.products,{id:pro.id})?\n                                _.find(cart.products,{id:pro.id}).buyNum :\n                                0\n                                }}\n                            </span>\n                            <a href=\"javascript:;\" class=\"sub\" ng-click=\"removeProduct(pro.id)\"><img src=\"images/ico_j.png\" /></a>\n                        </div>\n                    </div>\n            </li>\n        </ul>\n    </div>\n</div>\n\n<div class=\"clear\"></div>\n\n</div>\n\n\n<div class=\"product-detail\" ng-show=\"productShown\">\n\n    <dl>\n        <dt><em ng-click=\"productShown=false\"><img src=\"images/ico_5.png\" /></em></dt>\n        <dd class=\"mb-11\">\n            <em class=\"project-detail-img\"><img src=\"{{productDetail.img}}\" /></em>\n            <h3>{{productDetail.name}}</h3>\n\n            <div class=\"money clearfix\">\n                <strong>￥{{productDetail.price}}</strong>\n\n                <div class=\"numN fr\" style=\"padding:0;\">\n                    <a href=\"javascript:;\" class=\"add1\" ng-click=\"addProduct(productDetail.id)\">\n                        <img src=\"images/ico_a1.png\">\n                    </a>\n                    <span>\n                        {{\n                            _.find(cart.products,{id:productDetail.id})?\n                            _.find(cart.products,{id:productDetail.id}).buyNum :\n                            0\n                        }}\n                    </span>\n                    <a href=\"javascript:;\" class=\"sub1\" ng-click=\"removeProduct(productDetail.id)\">\n                        <img src=\"images/ico_j1.png\">\n                    </a>\n                </div>\n            </div>\n\n        <div class=\"product-detail-content\">\n            <strong>商品详情</strong>\n\n            <p>\n                {{productDetail.detail}}\n            </p>\n\n        </div>\n    </dd>\n</dl>\n</div>\n\n");
$templateCache.put("storeSale.html","\n<div class=\"main bge\" ng-style=\"{height:mainHeight-42}\">\n\n	<div class=\"productSaleList fr\" ng-style=\"{height:mainHeight-79}\">\n		<div class=\"greensSale lazy-sec relR scrollable-content-div\" id=\"base\">\n			<ul class=\"clearfix\" id=\"hot\">\n				<li ng-repeat=\"hot in hots track by $index\">\n					<em class=\"project-detail-img\">\n						<img  ng-click=\"showProduct(hot.id)\" bn-lazy-src=\"{{hot.img}}\" />\n					</em>\n					<p>\n						<strong>{{hot.name}}</strong>\n						<b class=\"org\">￥{{hot.price}}</b>\n					</p>\n					<div class=\"num\">\n						<a href=\"javascript:;\"\n						   ng-click=\"addProduct(hot.id);fly($event)\"\n						   ng-hide=\"_.find(cart.products,{id:hot.id}) &&\n					   		_.find(cart.products,{id:hot.id}).buyNum == _.find(cart.products,{id:hot.id}).num\"\n						   class=\"add\">\n							<img src=\"images/ico_a.png\" /></a>\n						<div ng-show=\"_.find(cart.products,{id:hot.id})\">\n						<span>\n							{{\n							   _.find(cart.products,{id:hot.id})\n							? _.find(cart.products,{id:hot.id}).buyNum\n							: 0\n							}}\n						</span>\n							<a href=\"javascript:;\" ng-click=\"removeProduct(hot.id)\" class=\"sub\">\n								<img src=\"images/ico_j.png\" /></a>\n\n						</div>\n					</div>\n				</li>\n\n			</ul>\n			</div>\n		</div>\n</div>\n\n\n\n<div class=\"product-detail\" ng-show=\"prodectShown\">\n	<dl>\n		<dt><em ng-click=\"prodectShown=false\"><img src=\"images/ico_5.png\" /></em></dt>\n		<dd>\n			<em><img src=\"{{productDetail.img}}\" /></em>\n			<h3>{{productDetail.name}}</h3>\n\n			<div class=\"money clearfix\">\n				<strong>￥{{productDetail.price}}</strong>\n\n				<div class=\"numN fr\" style=\"padding:0;\">\n					<a href=\"javascript:;\" class=\"add1\" ng-click=\"addProduct(productDetail.id)\">\n						<img src=\"images/ico_a1.png\">\n					</a>\n				<span>\n					{{\n						_.find(cart.products,{id:productDetail.id})?\n						_.find(cart.products,{id:productDetail.id}).buyNum :\n						0\n					}}\n				</span>\n					<a href=\"javascript:;\" class=\"sub1\" ng-click=\"removeProduct(productDetail.id)\">\n						<img src=\"images/ico_j1.png\">\n					</a>\n				</div>\n			</div>\n\n			<div class=\"product-detail-content\">\n				<strong>商品详情</strong>\n\n				<p>\n					{{productDetail.detail}}\n				</p>\n\n			</div>\n		</dd>\n	</dl>\n</div>\n\n\n\n\n\n\n");
$templateCache.put("transactionDetail.html","<div class=\"mian-section\">\n\n    <header class=\"header\">\n        <div class=\"back\">\n            <a href=\"javascript:window.history.back();\"><img src=\"images/ico_1.png\"></a>\n        </div>\n        <div class=\"title\">\n            {{title}}\n        </div>\n        <div class=\"del\">\n            <a ng-click=\"goIndex()\"href=\"javascript:;\" class=\"blue\">主页</a>\n        </div>\n    </header>\n\n    <div class=\"main mt-48\">\n        <div class=\"dan\"ng-repeat=\"items in transaction\">\n            <div class=\"hao clearfix\">\n                <strong>交易流水号:{{items.number}}</strong><br>\n                <a href=\"items.html\">订单号{{items.order}}，消费￥{{items.cost}}元</a>\n            </div>\n            <div class=\"time clearfix\">\n\n                <span>{{items.order_date | date:\'yyyy-MM-dd HH:mm:ss\'}}</span>\n            </div>\n        </div>\n\n    </div>\n\n</div>");}]);
//# sourceMappingURL=app.min.js.map
